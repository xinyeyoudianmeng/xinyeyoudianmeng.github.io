<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性取向测试（异性恋/同性恋/双性恋）</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- 统一的 Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#d946ef',
                        secondary: '#f9a8d4',
                        accent: '#a855f7',
                        neutral: '#f5f3ff',
                        'neutral-dark': '#e9d5ff'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.5s ease-in-out',
                        'pulse-light': 'pulse 1s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        pulse: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.7' },
                        },
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.37)',
                    },
                    backdropBlur: {
                        'glass': '4px',
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .glass-effect {
                @apply bg-white bg-opacity-20 backdrop-blur-glass shadow-glass border border-white border-opacity-20 rounded-xl;
            }
            .btn-primary {
                @apply bg-primary hover:bg-opacity-90 text-white font-medium py-3 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50;
            }
            .btn-secondary {
                @apply bg-white bg-opacity-30 hover:bg-opacity-40 text-primary font-medium py-3 px-6 rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50;
            }
            .input-range {
                @apply w-full h-2 bg-neutral-dark rounded-lg appearance-none cursor-pointer;
            }
            .input-range::-webkit-slider-thumb {
                @apply appearance-none w-6 h-6 bg-primary rounded-full shadow-md;
            }
            .question-card {
                @apply glass-effect p-6 mb-6 animate-fade-in;
            }
            .option-btn {
                @apply w-full text-left p-4 mb-3 rounded-lg transition-all duration-300 border-2 border-transparent hover:border-primary focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50;
            }
            .option-btn.selected {
                @apply border-primary bg-primary bg-opacity-10;
            }
            .option-btn.loading {
                @apply animate-pulse-light opacity-80 cursor-not-allowed;
            }
            .progress-bar {
                @apply h-2 bg-neutral-dark rounded-full overflow-hidden;
            }
            .progress-value {
                @apply h-full bg-gradient-to-r from-primary to-accent transition-all duration-500 ease-out;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 to-purple-100 min-h-screen font-sans text-gray-800">
    <!-- 背景图 -->
    <div class="fixed inset-0 z-0 opacity-20">
        <img src="https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/7be20d0b3c1349a49c35bf5bf2a3fd7a~tplv-a9rns2rl98-image.image?rcl=20251206190341ABA2F9A2B17AB90B410C&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767611037&x-signature=0tPkdGWJLqEGNDHuh2TaDb%2BC%2BVc%3D" 
             alt="背景" class="w-full h-full object-cover">
    </div>

    <div class="relative z-10 container mx-auto px-4 py-8 max-w-4xl">
        <!-- 开始页面 -->
        <section id="start-section" class="flex flex-col items-center justify-center min-h-[80vh] animate-fade-in">
            <div class="glass-effect p-8 md:p-12 rounded-3xl text-center max-w-2xl">
                <div class="mb-6 flex justify-center">
                    <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/420005efb3704faf846dcad7186485c2~tplv-a9rns2rl98-image.image?rcl=20251206190341ABA2F9A2B17AB90B410C&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767611034&x-signature=Vvov9NSBs69mdZDmfGyNhf8ecJM%3D" 
                         alt="Logo" class="w-32 h-32 object-contain">
                </div>
                <h1 class="text-4xl md:text-5xl font-bold mb-6 bg-gradient-to-r from-primary to-accent text-transparent bg-clip-text">
                    性取向测试
                </h1>
                <p class="text-lg md:text-xl mb-8 text-gray-700">
                    探索你的性取向倾向，了解更真实的自己，包含异性恋、同性恋、双性恋维度评估
                </p>
                <div class="space-y-4">
                    <button id="start-test-btn" class="btn-primary w-full">
                        开始测试
                    </button>
                    <button id="about-btn" class="btn-secondary w-full">
                        了解更多
                    </button>
                </div>
            </div>
            
            <!-- 隐私声明和原创声明 -->
            <div class="mt-8 text-sm text-gray-600 text-center max-w-lg">
                <p>本测试仅供教育和自我探索目的，所有数据严格保密</p>
                <p class="mt-2">测试结果不构成医疗或专业建议</p>
                <div class="mt-4 p-3 bg-white bg-opacity-50 rounded-lg">
                    <p class="font-medium text-primary">原创声明</p>
                    <p class="mt-1">本测试为原创设计，参考金赛性取向量表核心逻辑，结果仅供娱乐参考，不构成专业心理评估结论。</p>
                </div>
            </div>
        </section>

        <!-- 关于页面 -->
        <section id="about-section" class="hidden animate-fade-in">
            <div class="glass-effect p-8 rounded-3xl">
                <div class="flex items-center mb-6">
                    <button id="back-from-about-btn" class="mr-4 text-gray-600 hover:text-primary">
                        <i class="fa fa-arrow-left text-xl"></i>
                    </button>
                    <h2 class="text-3xl font-bold">关于本测试</h2>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-primary">测试简介</h3>
                        <p>本测试参考金赛性取向量表（Kinsey Scale）的核心逻辑，从情感吸引、性吸引、行为倾向等多个维度评估你的性取向特征，帮助你了解自己在异性恋-同性恋连续体上的位置。</p>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-primary">测试维度</h3>
                        <ul class="list-disc pl-5 space-y-2">
                            <li><span class="font-medium">情感吸引</span>：评估你对不同性别的情感吸引程度</li>
                            <li><span class="font-medium">性吸引</span>：探索你对不同性别的性吸引力感受</li>
                            <li><span class="font-medium">行为倾向</span>：了解你在实际行为中的偏好和倾向</li>
                            <li><span class="font-medium">幻想偏好</span>：评估你的性幻想对象性别倾向</li>
                            <li><span class="font-medium">身份认同</span>：探索你对自身性取向身份的认知</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-primary">测试说明</h3>
                        <p>测试包含20道题目，预计需要5-10分钟完成。所有问题均采用匿名方式，结果仅对你可见。</p>
                        <p class="mt-2">请根据你的真实感受和经历回答，选择最符合你情况的选项。性取向是一个连续谱，没有绝对的"正确"或"错误"。</p>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-primary">隐私保护</h3>
                        <p>我们非常重视你的隐私。所有测试数据仅存储在你的设备上，不会上传至任何服务器。你可以随时清除浏览器数据来删除你的测试记录。</p>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-semibold mb-2 text-primary">免责说明</h3>
                        <p>本测试结果仅供参考，不构成医疗、心理或法律建议。测试内容不替代专业医疗或心理咨询。如果你对自己的性取向有困惑，建议咨询专业的心理健康提供者。</p>
                    </div>
                </div>
                
                <button id="start-from-about-btn" class="btn-primary w-full mt-8">
                    开始测试
                </button>
            </div>
        </section>

        <!-- 测试页面 -->
        <section id="test-section" class="hidden">
            <!-- 进度条 -->
            <div class="glass-effect p-4 mb-6 rounded-xl">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-medium">测试进度</span>
                    <span id="progress-text" class="text-sm">0/20</span>
                </div>
                <div class="progress-bar">
                    <div id="progress-value" class="progress-value" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- 问题卡片 -->
            <div id="question-container" class="glass-effect p-6 md:p-8 rounded-3xl mb-6">
                <!-- 问题将通过JavaScript动态插入 -->
                <div class="p-4 bg-yellow-50 text-yellow-800 rounded-lg mb-6">
                    <p class="font-medium">本测试仅供自我探索，不构成专业心理评估</p>
                </div>
            </div>
            
            <!-- 导航按钮 -->
            <div class="flex justify-between">
                <button id="prev-btn" class="btn-secondary w-1/3 opacity-50 cursor-not-allowed" disabled>
                    <i class="fa fa-arrow-left mr-2"></i> 上一题
                </button>
                <button id="next-btn" class="btn-primary w-2/3 hidden">
                    下一题 <i class="fa fa-arrow-right ml-2"></i>
                </button>
            </div>
        </section>

        <!-- 结果页面 -->
        <section id="result-section" class="hidden animate-fade-in">
            <div class="glass-effect p-6 md:p-8 rounded-3xl mb-6">
                <div class="p-4 bg-yellow-50 text-yellow-800 rounded-lg mb-6">
                    <p class="font-medium">测试结果仅供参考，性取向是复杂且多元的，本测试仅提供参考维度</p>
                </div>
                <h2 class="text-3xl font-bold mb-6 text-center">你的性取向分析</h2>
                
                <!-- 结果图表 -->
                <div class="mb-8">
                    <canvas id="result-chart" height="300"></canvas>
                </div>
                
                <!-- 核心结果 -->
                <div class="mb-8 text-center">
                    <div id="orientation-result" class="text-2xl font-bold text-primary mb-4"></div>
                    <div id="orientation-description" class="text-lg text-gray-700 max-w-2xl mx-auto"></div>
                </div>
                
                <!-- 维度分析 -->
                <div id="dimension-analysis" class="space-y-6 mb-8">
                    <!-- 维度分析将通过JavaScript动态插入 -->
                </div>
                
                <!-- AI解读 -->
                <div class="mt-8 p-4 bg-primary bg-opacity-10 rounded-xl border border-primary border-opacity-20">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fa fa-lightbulb-o text-primary mr-2"></i>
                        <span>个性化解读</span>
                    </h3>
                    <div id="ai-insight" class="text-gray-700">
                        <!-- AI解读将通过JavaScript动态插入 -->
                    </div>
                </div>
                
                <!-- 科普信息 -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">性取向科普</h3>
                    <div class="space-y-4 text-gray-700">
                        <p>性取向是一个连续谱，而非非黑即白的分类。金赛量表将性取向分为0-6七个等级：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>0：完全异性恋</li>
                            <li>1：主要是异性恋，偶尔有同性恋倾向</li>
                            <li>2：主要是异性恋，但有明显的同性恋倾向</li>
                            <li>3：双性恋</li>
                            <li>4：主要是同性恋，但有明显的异性恋倾向</li>
                            <li>5：主要是同性恋，偶尔有异性恋倾向</li>
                            <li>6：完全同性恋</li>
                        </ul>
                        <p class="mt-2">许多人的性取向处于这些分类之间，并且可能会随着时间和经历发生变化。</p>
                    </div>
                </div>
            </div>
            
            <!-- 操作按钮（移除了分享按钮） -->
            <div class="flex flex-col space-y-4">
                <button id="save-result-btn" class="btn-primary w-full">
                    <i class="fa fa-download mr-2"></i> 保存结果
                </button>
                <button id="restart-btn" class="btn-secondary w-full">
                    <i class="fa fa-refresh mr-2"></i> 重新测试
                </button>
            </div>
        </section>
    </div>

    <script>
        // 性取向测试问题数据
        const testQuestions = [
            {
                id: 1,
                dimension: "情感吸引",
                question: "你会对哪个性别的人产生浪漫的情感吸引？",
                type: "single",
                options: [
                    "只对异性产生浪漫吸引",
                    "主要对异性，偶尔对同性",
                    "对异性和同性都有一定的吸引",
                    "主要对同性，偶尔对异性",
                    "只对同性产生浪漫吸引"
                ]
            },
            {
                id: 2,
                dimension: "性吸引",
                question: "你会对哪个性别的人产生性吸引力的感觉？",
                type: "single",
                options: [
                    "只对异性有性吸引力的感觉",
                    "主要对异性，偶尔对同性",
                    "对异性和同性都有性吸引力的感觉",
                    "主要对同性，偶尔对异性",
                    "只对同性有性吸引力的感觉"
                ]
            },
            {
                id: 3,
                dimension: "行为倾向",
                question: "你有过与哪个性别的人发生亲密/性关系的经历？",
                type: "single",
                options: [
                    "只与异性有过",
                    "主要与异性，有过1-2次同性经历",
                    "与异性和同性都有过多次经历",
                    "主要与同性，有过1-2次异性经历",
                    "只与同性有过"
                ]
            },
            {
                id: 4,
                dimension: "幻想偏好",
                question: "你的性幻想对象主要是哪个性别？",
                type: "single",
                options: [
                    "只幻想异性",
                    "主要幻想异性，偶尔幻想同性",
                    "幻想异性和同性的频率差不多",
                    "主要幻想同性，偶尔幻想异性",
                    "只幻想同性"
                ]
            },
            {
                id: 5,
                dimension: "身份认同",
                question: "你如何认同自己的性取向？",
                type: "single",
                options: [
                    "完全认同自己是异性恋",
                    "认为自己主要是异性恋，但有一点双性恋倾向",
                    "认为自己是双性恋",
                    "认为自己主要是同性恋，但有一点双性恋倾向",
                    "完全认同自己是同性恋"
                ]
            },
            {
                id: 6,
                dimension: "情感吸引",
                question: "当你坠入爱河时，对象通常是哪个性别？",
                type: "single",
                options: [
                    "只爱过异性",
                    "主要爱过异性，有过一次短暂的同性爱慕",
                    "爱过异性也爱过同性，次数差不多",
                    "主要爱过同性，有过一次短暂的异性爱慕",
                    "只爱过同性"
                ]
            },
            {
                id: 7,
                dimension: "性吸引",
                question: "看到有魅力的人时，你会被哪个性别的人吸引？",
                type: "single",
                options: [
                    "只被异性吸引",
                    "主要被异性吸引，偶尔注意到有魅力的同性",
                    "同等程度地被有魅力的异性和同性吸引",
                    "主要被同性吸引，偶尔注意到有魅力的异性",
                    "只被同性吸引"
                ]
            },
            {
                id: 8,
                dimension: "行为倾向",
                question: "你希望未来的亲密/性关系对象是哪个性别？",
                type: "single",
                options: [
                    "只希望是异性",
                    "主要希望是异性，不排斥偶尔的同性体验",
                    "对异性和同性都开放",
                    "主要希望是同性，不排斥偶尔的异性体验",
                    "只希望是同性"
                ]
            },
            {
                id: 9,
                dimension: "幻想偏好",
                question: "你的浪漫幻想（非性）对象主要是哪个性别？",
                type: "single",
                options: [
                    "只幻想与异性的浪漫关系",
                    "主要幻想与异性，偶尔幻想与同性",
                    "幻想与异性和同性的浪漫关系都有",
                    "主要幻想与同性，偶尔幻想与异性",
                    "只幻想与同性的浪漫关系"
                ]
            },
            {
                id: 10,
                dimension: "身份认同",
                question: "你向他人描述自己的性取向时，会如何说？",
                type: "single",
                options: [
                    "明确说自己是异性恋",
                    "说自己是异性恋，但补充说对同性也有一点点兴趣",
                    "说自己是双性恋",
                    "说自己是同性恋，但补充说对异性也有一点点兴趣",
                    "明确说自己是同性恋"
                ]
            },
            {
                id: 11,
                dimension: "情感吸引",
                question: "你会对哪个性别的朋友产生超出友谊的情感？",
                type: "single",
                options: [
                    "只对异性朋友",
                    "主要对异性朋友，有过1-2次对同性朋友",
                    "对异性和同性朋友都有过",
                    "主要对同性朋友，有过1-2次对异性朋友",
                    "只对同性朋友"
                ]
            },
            {
                id: 12,
                dimension: "性吸引",
                question: "你会对哪个性别的名人/公众人物产生迷恋？",
                type: "single",
                options: [
                    "只迷恋异性名人",
                    "主要迷恋异性，偶尔迷恋同性名人",
                    "迷恋异性和同性名人的频率差不多",
                    "主要迷恋同性，偶尔迷恋异性名人",
                    "只迷恋同性名人"
                ]
            },
            {
                id: 13,
                dimension: "行为倾向",
                question: "你愿意与哪个性别的人建立长期伴侣关系？",
                type: "single",
                options: [
                    "只愿意与异性",
                    "主要愿意与异性，不排除短期的同性关系",
                    "对异性和同性都愿意考虑",
                    "主要愿意与同性，不排除短期的异性关系",
                    "只愿意与同性"
                ]
            },
            {
                id: 14,
                dimension: "幻想偏好",
                question: "你的春梦（睡眠中的性梦）对象主要是哪个性别？",
                type: "single",
                options: [
                    "只梦到异性",
                    "主要梦到异性，偶尔梦到同性",
                    "梦到异性和同性的次数差不多",
                    "主要梦到同性，偶尔梦到异性",
                    "只梦到同性"
                ]
            },
            {
                id: 15,
                dimension: "身份认同",
                question: "你认为自己的性取向是固定的还是流动的？",
                type: "single",
                options: [
                    "完全固定的异性恋",
                    "基本固定为异性恋，可能有微小变化",
                    "比较流动，可能在不同时期有不同倾向",
                    "基本固定为同性恋，可能有微小变化",
                    "完全固定的同性恋"
                ]
            },
            {
                id: 16,
                dimension: "情感吸引",
                question: "你会嫉妒哪个性别的人与你喜欢的人亲近？",
                type: "single",
                options: [
                    "只嫉妒异性",
                    "主要嫉妒异性，偶尔嫉妒同性",
                    "嫉妒异性和同性的程度差不多",
                    "主要嫉妒同性，偶尔嫉妒异性",
                    "只嫉妒同性"
                ]
            },
            {
                id: 17,
                dimension: "性吸引",
                question: "你会被哪个性别的人的声音/气味/触感等感官特征吸引？",
                type: "single",
                options: [
                    "只被异性的感官特征吸引",
                    "主要被异性吸引，偶尔注意到同性的感官特征",
                    "同等程度地被异性和同性的感官特征吸引",
                    "主要被同性吸引，偶尔注意到异性的感官特征",
                    "只被同性的感官特征吸引"
                ]
            },
            {
                id: 18,
                dimension: "行为倾向",
                question: "你有过与哪个性别的人约会的经历？",
                type: "single",
                options: [
                    "只与异性约会过",
                    "主要与异性，有过1-2次同性约会",
                    "与异性和同性都有过多次约会",
                    "主要与同性，有过1-2次异性约会",
                    "只与同性约会过"
                ]
            },
            {
                id: 19,
                dimension: "幻想偏好",
                question: "当你阅读浪漫/情色内容时，偏好哪个性别的主角？",
                type: "single",
                options: [
                    "只偏好异性主角的内容",
                    "主要偏好异性，偶尔看同性主角的内容",
                    "对异性和同性主角的内容都感兴趣",
                    "主要偏好同性，偶尔看异性主角的内容",
                    "只偏好同性主角的内容"
                ]
            },
            {
                id: 20,
                dimension: "身份认同",
                question: "如果可以选择，你希望自己的性取向是怎样的？",
                type: "single",
                options: [
                    "希望保持纯异性恋",
                    "希望主要是异性恋，保留一点多样性",
                    "满意自己当前的双性恋倾向",
                    "希望主要是同性恋，保留一点多样性",
                    "希望保持纯同性恋"
                ]
            }
        ];

        // 性取向结果解释
        const orientationResults = {
            0: {
                name: "完全异性恋",
                description: "你在情感、性吸引、行为和幻想等各个维度都表现出完全的异性恋倾向。你只对异性产生浪漫和性的吸引，并且认同自己为异性恋。",
                insight: "你的性取向特征非常明确，属于典型的异性恋模式。这是最常见的性取向类型，无需为此感到任何特别。重要的是接纳并善待自己的性取向，同时也尊重他人的多样性。"
            },
            1: {
                name: "主要异性恋（轻微同性恋倾向）",
                description: "你主要表现出异性恋倾向，但在某些方面（如幻想、情感吸引）偶尔会对同性产生兴趣。这种轻微的多样性是非常正常的。",
                insight: "许多人都有轻微的跨性别吸引体验，这是人类性取向多样性的正常表现。你的主要倾向仍然是异性恋，但这种轻微的灵活性让你对人性有更丰富的理解。"
            },
            2: {
                name: "主要异性恋（明显同性恋倾向）",
                description: "你主要是异性恋，但在多个维度上都表现出明显的同性恋倾向。你可能在情感或性方面对同性有显著的兴趣和吸引力。",
                insight: "你的性取向处于异性恋和双性恋之间的过渡地带。这种情况表明你对不同性别的吸引力有更广泛的体验，是性取向连续谱中非常正常的位置。"
            },
            3: {
                name: "双性恋",
                description: "你在情感和性方面对异性和同性都表现出显著的吸引力。你的经历、幻想和认同都显示出平衡的双性恋特征。",
                insight: "双性恋是一种完全正常的性取向，意味着你有能力对任何性别的人产生情感和性的吸引。双性恋者常常能以更包容的视角理解人类的情感和亲密关系。"
            },
            4: {
                name: "主要同性恋（明显异性恋倾向）",
                description: "你主要是同性恋，但在多个维度上都表现出明显的异性恋倾向。你可能在情感或性方面对异性仍有一定的兴趣和吸引力。",
                insight: "你的性取向处于同性恋和双性恋之间的过渡地带。这种情况表明你的主要吸引对象是同性，但仍保留了对异性的一定开放性，这在性取向连续谱中是完全正常的。"
            },
            5: {
                name: "主要同性恋（轻微异性恋倾向）",
                description: "你主要表现出同性恋倾向，但在某些方面（如幻想、情感吸引）偶尔会对异性产生兴趣。这种轻微的多样性是非常正常的。",
                insight: "你的主要性取向是同性恋，但保留了轻微的异性吸引体验，这是性取向多样性的正常表现。重要的是接纳自己的全部感受，不必强求自己符合任何刻板分类。"
            },
            6: {
                name: "完全同性恋",
                description: "你在情感、性吸引、行为和幻想等各个维度都表现出完全的同性恋倾向。你只对同性产生浪漫和性的吸引，并且认同自己为同性恋。",
                insight: "你的性取向特征非常明确，属于同性恋模式。同性恋是人类性取向的正常变体之一，和异性恋一样值得尊重和接纳。最重要的是做真实的自己。"
            }
        };

        // DOM元素（移除了分享相关元素）
        const startSection = document.getElementById('start-section');
        const aboutSection = document.getElementById('about-section');
        const testSection = document.getElementById('test-section');
        const resultSection = document.getElementById('result-section');
        
        const startTestBtn = document.getElementById('start-test-btn');
        const aboutBtn = document.getElementById('about-btn');
        const backFromAboutBtn = document.getElementById('back-from-about-btn');
        const startFromAboutBtn = document.getElementById('start-from-about-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const saveResultBtn = document.getElementById('save-result-btn');
        const restartBtn = document.getElementById('restart-btn');
        
        const progressText = document.getElementById('progress-text');
        const progressValue = document.getElementById('progress-value');
        const questionContainer = document.getElementById('question-container');
        const orientationResult = document.getElementById('orientation-result');
        const orientationDescription = document.getElementById('orientation-description');
        const dimensionAnalysis = document.getElementById('dimension-analysis');
        const aiInsight = document.getElementById('ai-insight');
        
        // 测试状态
        let currentQuestionIndex = 0;
        const userAnswers = {};
        let currentTestResult = null; // 存储当前测试结果，避免重复计算
        
        // DOM加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定事件监听器（移除了分享相关事件）
            startTestBtn.addEventListener('click', startTest);
            aboutBtn.addEventListener('click', showAbout);
            backFromAboutBtn.addEventListener('click', showStart);
            startFromAboutBtn.addEventListener('click', startTest);
            prevBtn.addEventListener('click', goToPreviousQuestion);
            nextBtn.addEventListener('click', goToNextQuestion);
            saveResultBtn.addEventListener('click', saveResult);
            restartBtn.addEventListener('click', restartTest);
            
            // 初始化页面
            init();
        });
        
        // 初始化页面
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('result')) {
                try {
                    const savedResult = JSON.parse(decodeURIComponent(urlParams.get('result')));
                    currentTestResult = savedResult;
                    showResult(savedResult);
                } catch (e) {
                    console.error('无法解析结果参数', e);
                    showStart();
                }
            } else {
                showStart();
            }
        }
        
        // 显示开始页面
        function showStart() {
            startSection.classList.remove('hidden');
            aboutSection.classList.add('hidden');
            testSection.classList.add('hidden');
            resultSection.classList.add('hidden');
        }
        
        // 显示关于页面
        function showAbout() {
            startSection.classList.add('hidden');
            aboutSection.classList.remove('hidden');
            testSection.classList.add('hidden');
            resultSection.classList.add('hidden');
        }
        
        // 开始测试
        function startTest() {
            currentQuestionIndex = 0;
            currentTestResult = null;
            Object.keys(userAnswers).forEach(key => delete userAnswers[key]);
            
            startSection.classList.add('hidden');
            aboutSection.classList.add('hidden');
            testSection.classList.remove('hidden');
            resultSection.classList.add('hidden');
            
            updateQuestion();
            updateProgress();
            updateNavigationButtons();
        }
        
        // 更新问题
        function updateQuestion() {
            const question = testQuestions[currentQuestionIndex];
            // 清空容器并插入新问题
            questionContainer.innerHTML = `
                <div class="mb-2 text-sm text-primary font-medium">${question.dimension}</div>
                <h3 class="text-2xl font-bold mb-6">${question.question}</h3>
                <div class="space-y-3" id="options-container">
                    ${question.options.map((option, index) => `
                        <button class="option-btn ${userAnswers[question.id] === index ? 'selected' : ''}" 
                                data-index="${index}" data-question-id="${question.id}">
                            ${option}
                        </button>
                    `).join('')}
                </div>
                <div class="p-4 bg-yellow-50 text-yellow-800 rounded-lg mt-6">
                    <p class="font-medium">本测试仅供自我探索，不构成专业心理评估</p>
                </div>
            `;
            
            // 重新获取选项按钮
            const optionsContainer = document.getElementById('options-container');
            const optionButtons = optionsContainer.querySelectorAll('.option-btn');
            
            // 绑定点击事件
            optionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const selectedIndex = parseInt(this.dataset.index);
                    const questionId = parseInt(this.dataset.questionId);
                    
                    // 标记加载状态
                    optionButtons.forEach(btn => btn.classList.add('loading'));
                    
                    // 保存答案
                    userAnswers[questionId] = selectedIndex;
                    
                    // 标记选中状态
                    optionButtons.forEach(btn => btn.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // 更新进度
                    updateProgress();
                    
                    // 跳转逻辑
                    setTimeout(() => {
                        // 移除加载状态
                        optionButtons.forEach(btn => btn.classList.remove('loading'));
                        
                        if (currentQuestionIndex < testQuestions.length - 1) {
                            currentQuestionIndex++;
                            updateQuestion();
                            updateNavigationButtons();
                        } else {
                            const result = calculateResult();
                            currentTestResult = result; // 保存当前结果
                            showResult(result);
                        }
                    }, 300);
                });
            });
        }
        
        // 更新进度
        function updateProgress() {
            const answeredQuestions = Object.keys(userAnswers).length;
            const totalQuestions = testQuestions.length;
            const progressPercentage = (answeredQuestions / totalQuestions) * 100;
            
            progressText.textContent = `${answeredQuestions}/${totalQuestions}`;
            progressValue.style.width = `${progressPercentage}%`;
        }
        
        // 更新导航按钮
        function updateNavigationButtons() {
            if (currentQuestionIndex > 0) {
                prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                prevBtn.disabled = false;
            } else {
                prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
                prevBtn.disabled = true;
            }
            nextBtn.classList.add('hidden');
        }
        
        // 上一题
        function goToPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                updateQuestion();
                updateProgress();
                updateNavigationButtons();
            }
        }
        
        // 下一题
        function goToNextQuestion() {
            if (currentQuestionIndex < testQuestions.length - 1) {
                currentQuestionIndex++;
                updateQuestion();
                updateProgress();
                updateNavigationButtons();
            } else {
                const result = calculateResult();
                currentTestResult = result;
                showResult(result);
            }
        }
        
        // 计算结果
        function calculateResult() {
            // 计算各维度得分
            const dimensionScores = {
                "情感吸引": 0,
                "性吸引": 0,
                "行为倾向": 0,
                "幻想偏好": 0,
                "身份认同": 0
            };
            
            const dimensionCounts = {
                "情感吸引": 0,
                "性吸引": 0,
                "行为倾向": 0,
                "幻想偏好": 0,
                "身份认同": 0
            };
            
            testQuestions.forEach(question => {
                if (userAnswers[question.id] !== undefined) {
                    dimensionScores[question.dimension] += userAnswers[question.id];
                    dimensionCounts[question.dimension]++;
                }
            });
            
            // 计算各维度的平均得分（0-4分）
            const dimensionAverages = {};
            Object.keys(dimensionScores).forEach(dimension => {
                if (dimensionCounts[dimension] > 0) {
                    dimensionAverages[dimension] = dimensionScores[dimension] / dimensionCounts[dimension];
                } else {
                    dimensionAverages[dimension] = 0;
                }
            });
            
            // 计算总体得分（转换为金赛量表0-6分）
            const totalAverage = Object.values(dimensionAverages).reduce((sum, score) => sum + score, 0) / Object.keys(dimensionAverages).length;
            let kinseyScore = Math.round((totalAverage / 4) * 6);
            
            // 关键修复：限制得分在0-6范围内
            kinseyScore = Math.max(0, Math.min(6, kinseyScore));
            
            return {
                kinseyScore: kinseyScore,
                dimensionScores: dimensionAverages,
                totalAverage: totalAverage
            };
        }
        
        // 显示结果
        function showResult(result) {
            // 确保DOM元素已加载
            if (!resultSection || !orientationResult || !dimensionAnalysis) {
                console.error('结果区域DOM元素未找到');
                return;
            }
            
            startSection.classList.add('hidden');
            aboutSection.classList.add('hidden');
            testSection.classList.add('hidden');
            resultSection.classList.remove('hidden');
            
            // 更新URL参数
            try {
                const url = new URL(window.location.href);
                url.searchParams.set('result', encodeURIComponent(JSON.stringify(result)));
                window.history.pushState({}, '', url);
            } catch (e) {
                console.warn('更新URL失败:', e);
            }
            
            // 确保DOM渲染完成后再执行
            setTimeout(() => {
                // 渲染结果
                renderResult(result);
                renderDimensionAnalysis(result);
                renderInsight(result);
            }, 100);
        }
        
        // 渲染核心结果
        function renderResult(result) {
            // 检查必要元素是否存在
            if (!orientationResult || !orientationDescription || !aiInsight) {
                console.error('核心结果DOM元素缺失');
                return;
            }
            
            const kinseyScore = result.kinseyScore;
            // 确保kinseyScore有效
            const orientation = orientationResults[kinseyScore] || orientationResults[3]; // 默认双性恋
            
            // 设置核心结果
            orientationResult.textContent = orientation.name;
            orientationDescription.textContent = orientation.description;
            aiInsight.textContent = orientation.insight;
            
            // 渲染雷达图 - 增加错误处理
            try {
                const ctx = document.getElementById('result-chart');
                if (!ctx) {
                    console.warn('图表容器未找到');
                    return;
                }
                
                const chartCtx = ctx.getContext('2d');
                if (!chartCtx) {
                    console.warn('无法获取Canvas上下文');
                    return;
                }
                
                // 销毁旧图表
                if (window.resultChart) {
                    window.resultChart.destroy();
                }
                
                // 转换维度得分到0-100范围
                const chartScores = {};
                Object.keys(result.dimensionScores).forEach(dimension => {
                    chartScores[dimension] = Math.round((result.dimensionScores[dimension] / 4) * 100);
                });
                
                // 创建新图表
                window.resultChart = new Chart(chartCtx, {
                    type: 'radar',
                    data: {
                        labels: Object.keys(chartScores),
                        datasets: [{
                            label: '你的性取向倾向（0=完全异性恋，100=完全同性恋）',
                            data: Object.values(chartScores),
                            backgroundColor: 'rgba(217, 70, 239, 0.2)',
                            borderColor: 'rgba(217, 70, 239, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(217, 70, 239, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(217, 70, 239, 1)'
                        }]
                    },
                    options: {
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20
                                },
                                pointLabels: {
                                    font: {
                                        size: 14
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        let orientation = '';
                                        if (value < 20) orientation = '（强烈异性恋倾向）';
                                        else if (value < 40) orientation = '（主要异性恋倾向）';
                                        else if (value < 60) orientation = '（双性恋倾向）';
                                        else if (value < 80) orientation = '（主要同性恋倾向）';
                                        else orientation = '（强烈同性恋倾向）';
                                        return context.dataset.label + ': ' + value + '% ' + orientation;
                                    }
                                }
                            }
                        },
                        maintainAspectRatio: false
                    }
                });
            } catch (e) {
                console.error('图表渲染失败:', e);
                // 图表失败不影响其他结果显示
                const chartContainer = document.getElementById('result-chart').parentNode;
                chartContainer.innerHTML = '<div class="text-center py-8 text-gray-600">图表加载失败，但不影响结果查看</div>' + chartContainer.innerHTML;
            }
        }
        
        // 渲染维度分析
        function renderDimensionAnalysis(result) {
            if (!dimensionAnalysis) {
                console.error('维度分析容器未找到');
                return;
            }
            
            let analysisHTML = '';
            
            Object.keys(result.dimensionScores).forEach(dimension => {
                const score = result.dimensionScores[dimension];
                const percentage = Math.round((score / 4) * 100);
                let orientation = '';
                
                if (score < 0.8) orientation = '强烈的异性恋倾向';
                else if (score < 1.6) orientation = '主要的异性恋倾向';
                else if (score < 2.4) orientation = '平衡的双性恋倾向';
                else if (score < 3.2) orientation = '主要的同性恋倾向';
                else orientation = '强烈的同性恋倾向';
                
                let colorClass = '';
                if (score < 1.6) colorClass = 'bg-blue-100 text-blue-800';
                else if (score < 2.4) colorClass = 'bg-yellow-100 text-yellow-800';
                else colorClass = 'bg-pink-100 text-pink-800';
                
                analysisHTML += `
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold">${dimension}</h3>
                            <span class="text-sm font-medium px-3 py-1 rounded-full ${colorClass}">
                                ${orientation}
                            </span>
                        </div>
                        <div class="progress-bar mb-3">
                            <div class="progress-value" style="width: ${percentage}%"></div>
                        </div>
                        <div class="flex justify-between text-sm text-gray-600">
                            <span>完全异性恋</span>
                            <span>双性恋</span>
                            <span>完全同性恋</span>
                        </div>
                    </div>
                `;
            });
            
            dimensionAnalysis.innerHTML = analysisHTML;
        }
        
        // 渲染个性化解读
        function renderInsight(result) {
            if (!aiInsight) {
                console.error('个性化解读容器未找到');
                return;
            }
            
            const kinseyScore = result.kinseyScore;
            const orientation = orientationResults[kinseyScore] || orientationResults[3];
            aiInsight.textContent = orientation.insight;
        }
        
        // 保存结果
        function saveResult() {
            try {
                if (!currentTestResult) {
                    alert('暂无测试结果可保存，请先完成测试');
                    return;
                }
                
                const kinseyScore = currentTestResult.kinseyScore;
                const orientation = orientationResults[kinseyScore] || orientationResults[3];
                
                // 创建结果文本
                const resultText = `
性取向测试结果
============
金赛量表得分：${kinseyScore}（0=完全异性恋，6=完全同性恋）
性取向类型：${orientation.name}

核心描述：
${orientation.description}

个性化解读：
${orientation.insight}

各维度详细得分：
${Object.entries(currentTestResult.dimensionScores).map(([dimension, score]) => {
    const percentage = Math.round((score / 4) * 100);
    return `${dimension}: ${percentage}% (${score.toFixed(1)}/4.0)`;
}).join('\n')}

---
本测试仅供自我探索和教育目的，不构成专业心理评估。
                `.trim();
                
                // 创建下载链接
                const blob = new Blob([resultText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = '性取向测试结果.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('测试结果已保存为文本文件！');
            } catch (e) {
                console.error('保存结果失败:', e);
                alert('保存失败：' + e.message);
            }
        }
        
        // 重新测试
        function restartTest() {
            if (confirm('确定要重新开始测试吗？当前的测试结果将会丢失。')) {
                startTest();
            }
        }
    </script>
</body>
</html>
